
<!DOCTYPE html>
<html>
  <head>
    <script>
      function getFilename(fullPath) {
	  return fullPath.replace(/^.*[\\\/]/, '').replace(/\.[^.]*$/, '');
      }
      
      function upload_changed() {

	  if (document.getElementById('default-template').value != '1')
	  { return; }

	  event_filename = getFilename(document.getElementById('myfile').value);

	  document.getElementById('template').value = event_filename + '-%d.png';
      }

      function template_changed() {
	  document.getElementById('default-template').value = 0;
      }

      function display_error_message(msg) {
	  document.getElementById('message-area').innerHTML
	      = `<ul>${msg}</ul>`;
      }

      function clean_error_message() {
	  document.getElementById('message-area').innerHTML = '';
      }

      function has_valid_time(id) {
	  t = document.getElementById(id).value;

	  pattern=/^ *[0-9]+(\.[0-9]*([eE][-+][0-9]+)?)? *(s|ms|us|ns|fps)? *$/;
	  return pattern.test(t)
      }

      function mark(id) {
	  document.getElementById(id).style
	      ="border-color:red; background-color:faa";
      }

      function unmark(id) {
	  document.getElementById(id).style ="";
      }

      function validate() {
	  error_msg = "";
	  
	  decay=document.getElementById('decay').value;

	  if (decay == "lin" || decay == "exp") {
	      if (! has_valid_time('tau')) {
		  mark('tau');
		  error_msg = error_msg.concat("<li>Missing tau for decay");
	      } else {
		  unmark('tau');
	      }
	  }

	  if (! has_valid_time('fps')) {
	      mark('fps');
	      error_msg = error_msg.concat("<li>Invalid FPS specs");
	  }

	  file=document.getElementById('myfile').value;
	  if (file == "") {
	      mark('myfile');
	      error_msg = error_msg.concat("<li>Missing event file");
	  }

	  if (error_msg == "") {
	      return true; 
	  } else {
	      display_error_message(error_msg);
	      return false;
	  }
      }

      function decay_changed() {
	  decay=document.getElementById('decay').value;
	  document.getElementById('tau').disabled= (decay == "none" || decay == "step");
      }
    </script>
  </head>
  <body>
    <form action="pippo.xx" method="post" enctype='multipart/form-data' onsubmit='return validate();' accept-charset="utf-8">
      <table>
	<tr>
	  <td><label for="fps">Frame rate</label>
	  <td><input type="text" id="fps" name="fps" >
	<!--  <td><input type="text" id="gigi" name="gigi" > -->
	</tr>
	<tr>
	  <td><label for="template">Frame filename template</label>
	  <td><input type="text" id="template" name="template" value="" onchange="template_changed();">
	    <input type='hidden' id='default-template' name='default-template' value="1">
	</tr>
	<tr>
	  <td>
	    <fieldset>
	      <legend>Decay model</legend>
	    <select id="decay" name="decay" onchange="decay_changed();">
	      <option value="none">None</option>
	      <option value="lin">Linear</option>
	      <option value="exp">Exponential</option>
	      <option value="step">Step</option>
	    </select><br>
	    <label for="tau">Time constant</label>
	    <input type="text" id="tau" name="tau" disabled>
	    </fieldset>
	  </td>
	</tr>
      </table>
      <label for="myfile">Event file (CSV format):</label>
      <input type="file" id="myfile" name="myfile" onchange="upload_changed();" value=""><br>
      <input type="submit" value="Submit">
    </form>
    <div id='message-area'></div>
  </body>
</html>
